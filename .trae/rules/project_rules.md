# 招商线索流通Web应用项目规则

## 1. 技术栈约束

### 前端技术栈
- **框架**: Vue.js 3.x (必须)
- **UI组件库**: Element Plus 最新版
- **路由**: Vue Router 4.x
- **状态管理**: Pinia
- **HTTP客户端**: Axios
- **图表库**: ECharts 5.x
- **构建工具**: Vite

### 后端技术栈
- **应用框架**: Spring Boot 2.7.x (必须)
- **安全框架**: Spring Security 5.7.x
- **数据访问**: Spring Data JPA 2.7.x + MyBatis Plus 3.5.x
- **缓存**: Redis 6.x
- **消息队列**: RabbitMQ 3.9.x
- **搜索引擎**: Elasticsearch 7.x
- **数据库**: MySQL 8.0.x

### 开发工具
- **容器化**: Docker + Kubernetes
- **监控**: Prometheus + Grafana
- **日志**: ELK Stack
- **版本控制**: Git

## 2. 架构设计原则

### 核心原则
- **模块化单体架构**: 采用模块化单体架构，避免微服务复杂性
- **分层架构**: 严格按照表现层、网关层、应用层、数据层分层
- **事件驱动**: 模块间通过事件进行异步通信
- **安全优先**: 所有设计决策优先考虑安全性
- **可扩展性**: 支持水平扩展和功能扩展

### 模块划分
必须按照以下6个核心模块组织代码：
1. **用户管理模块** (User Management)
2. **线索管理模块** (Lead Management) 
3. **评级引擎模块** (Rating Engine)
4. **交换引擎模块** (Exchange Engine)
5. **数据分析模块** (Analytics)
6. **通知服务模块** (Notification)

## 3. 安全规范

### 认证授权
- **认证方式**: JWT + OAuth2.0
- **权限模型**: RBAC (基于角色的访问控制)
- **会话管理**: 无状态JWT令牌
- **权限粒度**: 功能级权限控制

### 数据安全
- **敏感数据加密**: 手机号、身份证等敏感信息必须加密存储
- **API权限控制**: 所有API接口必须进行权限验证
- **操作审计**: 关键操作必须记录审计日志
- **数据脱敏**: 对外展示数据必须脱敏处理

## 4. 性能要求

### 性能指标
- **并发用户**: 支持5000并发用户
- **用户规模**: 支持50000用户
- **可用性**: 99.9%系统可用性
- **响应时间**: API响应时间 < 500ms

### 性能优化策略
- **数据库**: 读写分离 + 主从复制
- **缓存**: Redis多级缓存策略
- **搜索**: Elasticsearch全文检索
- **CDN**: 静态资源CDN加速
- **数据库优化**: 索引优化 + 分库分表

## 5. 开发规范

### 代码组织
- **设计模式**: 采用DDD (领域驱动设计)
- **包结构**: Controller → Service → Repository → Domain
- **命名规范**: 驼峰命名法，类名首字母大写
- **注释要求**: 所有公共方法必须添加中文注释

### API设计
- **风格**: RESTful API设计
- **响应格式**: 统一JSON响应格式
- **状态码**: 标准HTTP状态码
- **分页**: 统一分页参数 (page, size)
- **排序**: 支持多字段排序

### 异常处理
- **全局异常处理**: 统一异常处理机制
- **错误码**: 业务错误码规范
- **日志记录**: 异常必须记录详细日志

## 6. 业务逻辑规范

### 线索管理
- **重复检测**: 使用编辑距离算法 + 中文分词
- **状态管理**: 严格按照状态机转换 (新建→审核中→交换中→已成交/已下架)
- **评级算法**: A/B/C/D四级评级，基于信息完整度、企业资质、规模、产业价值

### 交换机制
- **价值计算**: A级=8分，B级=4分，C级=2分，D级=1分
- **交换规则**: 1个A级 = 2个B级 = 4个C级 = 8个D级
- **交换流程**: 申请→验证→审核→执行→通知
- **事务处理**: 交换操作必须保证事务一致性

### 通知服务
- **事件驱动**: 基于事件发布订阅模式
- **多渠道**: 支持站内信、短信、邮件
- **模板管理**: 统一消息模板管理
- **异步处理**: 通知发送异步处理

## 7. 数据库设计规范

### 表设计
- **命名规范**: 下划线命名法 (snake_case)
- **主键**: 统一使用Long类型自增主键
- **时间字段**: 创建时间、更新时间必须字段
- **软删除**: 重要数据采用软删除
- **索引**: 查询字段必须建立索引

### 数据存储策略
- **MySQL**: 核心业务数据 (用户、线索、交换记录)
- **Redis**: 缓存热点数据、会话信息、分布式锁
- **Elasticsearch**: 线索搜索、全文检索、数据分析

## 8. 前端开发规范

### 组件设计
- **组件化**: 页面组件、业务组件、通用组件分离
- **状态管理**: 使用Pinia进行状态管理
- **路由管理**: 路由懒加载 + 权限控制
- **样式规范**: 使用CSS Modules或Scoped CSS

### UI/UX规范
- **设计风格**: 浅色硅谷科技风
- **响应式**: 支持PC端、平板端、移动端
- **交互反馈**: 加载状态、错误提示、成功反馈
- **可访问性**: 符合WCAG 2.1 AA标准

## 9. 测试规范

### 测试策略
- **单元测试**: 核心业务逻辑必须编写单元测试
- **集成测试**: API接口集成测试
- **性能测试**: 并发性能测试
- **安全测试**: 安全漏洞扫描

### 测试覆盖率
- **代码覆盖率**: ≥ 80%
- **分支覆盖率**: ≥ 70%
- **核心模块**: 100%覆盖率

## 10. 部署运维规范

### 容器化部署
- **容器**: Docker容器化部署
- **编排**: Kubernetes集群管理
- **配置**: ConfigMap + Secret配置管理
- **服务发现**: Kubernetes Service

### 监控告警
- **应用监控**: Prometheus + Grafana
- **日志分析**: ELK Stack (Elasticsearch + Logstash + Kibana)
- **链路追踪**: Jaeger分布式追踪
- **告警通知**: 钉钉、邮件告警

### CI/CD流程
- **代码检查**: SonarQube代码质量检查
- **自动构建**: Jenkins/GitLab CI自动构建
- **自动部署**: 蓝绿部署或滚动更新
- **回滚策略**: 支持快速回滚

## 11. 文档规范

### 技术文档
- **API文档**: Swagger/OpenAPI自动生成
- **数据库文档**: 表结构和字段说明
- **部署文档**: 环境配置和部署步骤
- **运维文档**: 监控指标和故障处理

### 代码注释
- **类注释**: 类的功能和职责说明
- **方法注释**: 参数、返回值、异常说明
- **复杂逻辑**: 算法和业务逻辑注释
- **配置注释**: 配置项的作用和取值范围

## 12. 版本管理规范

### Git工作流
- **分支策略**: Git Flow分支模型
- **提交规范**: Conventional Commits规范
- **代码审查**: Pull Request必须经过代码审查
- **版本标签**: 语义化版本号 (Semantic Versioning)

### 发布管理
- **版本计划**: 迭代版本发布计划
- **变更记录**: CHANGELOG.md记录变更
- **兼容性**: 向后兼容性保证
- **升级指南**: 版本升级操作指南